- name: Ensure software properties common package is installed (Debian/Ubuntu - Client).
  apt:
    state: latest
    name: software-properties-common
  become: true

- name: Add BeeGFS apt respository key (Debian/Ubuntu - Client).
  apt_key:
    url: "{{ beegfs_ha_debian_repository_gpgkey }}"
    state: present
  become: true

- name: Add BeeGFS apt respository (Debian/Ubuntu - Client).
  apt_repository:
    state: present
    repo: "deb [arch=amd64] {{ beegfs_ha_debian_repository_base_url }} stretch non-free"
    update_cache: true
  become: true

- name: Ensure NTP is installed (Debian/Ubuntu - Client).
  block:
    - name: Ensure NTP is installed (Debian/Ubuntu - Client).
      apt:
        state: latest
        name: ntp
      become: true
    - name: Ensure Chrony is uninstalled (Debian/Ubuntu - Client).
      apt:
        state: absent
        name: chrony
      become: true
  when: beegfs_ha_ntp_enabled == True

- name: Ensure Chrony is installed (Debian/Ubuntu - Client).
  block:
    - name: Ensure Chrony is installed (Debian/Ubuntu - Client).
      apt:
        state: latest
        name: chrony
      become: true
    - name: Ensure NTP is uninstalled (Debian/Ubuntu - Client).
      apt:
        state: absent
        name: ntp
      become: true
  when: beegfs_ha_chrony_enabled == True

- name: Ensure BeeGFS client package is installed (Debian/Ubuntu - Client).
  apt:
    state: "{% if beegfs_ha_force_beegfs_patch_upgrade %}latest{% else %}present{% endif %}"
    name:
      - "beegfs-client={{ beegfs_ha_beegfs_version }}"
      - "beegfs-helperd={{ beegfs_ha_beegfs_version }}"
      - "beegfs-utils={{ beegfs_ha_beegfs_version }}"
      - libelf-dev
  when: inventory_hostname in groups[beegfs_ha_ansible_client_group]
  become: true
